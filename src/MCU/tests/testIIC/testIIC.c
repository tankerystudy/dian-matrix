#include <reg52.h>
#include "..\..\commondriver\common_def.h"
#include "..\..\commondriver\serial_driver.h"
#include "..\..\commondriver\graphics_driver.h"
#include "..\..\commondriver\iic_driver.h"

/*
    简体汉字点阵
    字体：宋体   1个汉字
    点阵：16x16
    文本：给
*/
/*
idata byte g_SerialArray[LED_LINE][LED_ROW] =
{
    0x10,0x40,//  0x02,0x00,
    0x10,0x40,//  0x02,0x00,
    0x20,0xA0,//  0x02,0x00,
    0x21,0x10,//  0x02,0x00,
    0x4A,0x08,//  0x7F,0xF8,
    0xF4,0x06,//  0x02,0x08,
    0x13,0xF8,//  0x02,0x08,
    0x20,0x00,//  0x02,0x08,

    0x40,0x00,//  0x02,0x08,  
    0xFB,0xF8,//  0x04,0x08,
    0x42,0x08,//  0x04,0x08,
    0x02,0x08,//  0x08,0x08,
    0x1A,0x08,//  0x08,0x08,
    0xE2,0x08,//  0x10,0x88,
    0x43,0xF8,//  0x20,0x50,
    0x02,0x08//,  0x40,0x20
};
*/

/*
    简体汉字点阵
    字体：宋体   2个汉字
    点阵：16x16
    文本：给力
*/

idata byte g_SerialArray[LED_LINE][LED_ROW] =
{
    0x10,0x40,  0x02,0x00,
    0x10,0x40,  0x02,0x00,
    0x20,0xA0,  0x02,0x00,
    0x21,0x10,  0x02,0x00,
    0x4A,0x08,  0x7F,0xF8,
    0xF4,0x06,  0x02,0x08,
    0x13,0xF8,  0x02,0x08,
    0x20,0x00,  0x02,0x08,

    0x40,0x00,  0x02,0x08,  
    0xFB,0xF8,  0x04,0x08,
    0x42,0x08,  0x04,0x08,
    0x02,0x08,  0x08,0x08,
    0x1A,0x08,  0x08,0x08,
    0xE2,0x08,  0x10,0x88,
    0x43,0xF8,  0x20,0x50,
    0x02,0x08,  0x40,0x20
};


/*
idata byte g_SerialArray[LED_LINE][LED_ROW] =
{
//欢
    0x00,0x20,0x3C,0x10,
    0x44,0x08,0x84,0x04,
    0x04,0x03,0x04,0x03,
    0x84,0x04,0x44,0x08,
    0x3C,0x10,0x00,0x20,
    0x00,0x00,0x07,0x20,
    0x04,0x10,0xF4,0x0F,
    0x04,0x10,0x1C,0x20,
//迎
    0x00,0x00,0x49,0x20,
    0x6A,0x10,0xDC,0x0F,
    0x08,0x10,0x00,0x20,
    0xFE,0x27,0x02,0x22,
    0x02,0x21,0x81,0x20,
    0x00,0x20,0x02,0x20,
    0xFE,0x2F,0x02,0x22,
    0x02,0x22,0xFE,0x21
};*/


void main()
{
    unsigned char x, y;

    LED1= LED2= LED3= 1;    // switch off 3 LEDs
    
    for (y=0; y < LED_LINE; y++)
    {
       for (x=0; x < LED_ROW; x++)
        {
    		g_SerialArray[y][x] = ~g_SerialArray[y][x];
    	}
    }

    // writing IIC
    if (I2COpen(0x00, I2CDEFAULT))
    {
        x = I2CWrite(&g_SerialArray[0][0], (LED_LINE * LED_ROW));

        switch (x)
        {
        case 1:
            LED1 = 0;
            break;
        case 2:
            LED2 = 0;
            break;
        case 3:
            LED3 = 0;
            break;
        default:
            break;
        }

        I2CClose();
    }
    else
    {
        LED1 = LED2 = 0;
    }

    // clear array.
    for (y=0; y < LED_LINE; y++)
    {
       for (x=0; x < LED_ROW; x++)
        {
    		g_SerialArray[y][x] = ~(y*LED_ROW + x);
    	}
    }

    // reading IIC
    if (I2COpen(0x00, I2CREAD))
    {
        I2CReadOneTime(&g_SerialArray[0][0], (LED_LINE * LED_ROW));
        I2CClose();
    }
    else
    {
        LED2 = LED3 = 0;
    }

	GDI_Init(&g_SerialArray[0][0], (LED_LINE * LED_ROW));
    GDI_DisFormat();

    while (1)
    {
    	GDI_Refresh();

        sleep(1);
    }
}

